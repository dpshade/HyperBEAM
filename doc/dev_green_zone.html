<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.35.1">
    <meta name="project" content="hb v0.0.1">


    <title>dev_green_zone â€” hb v0.0.1</title>
    <link rel="stylesheet" href="dist/html-erlang-4IXSOGMD.css" />


    <script src="dist/handlebars.runtime-NWIB6V2M.js"></script>
    <script src="dist/handlebars.templates-K7URE6B4.js"></script>
    <script src="dist/sidebar_items-BF2C6ECE.js"></script>
    <script src="docs_config.js"></script>
    <script async src="dist/html-PVRIOB7F.js"></script>

  </head>
  <body data-type="modules" class="page-module">
    <script>

      try {
        var settings = JSON.parse(localStorage.getItem('ex_doc:settings') || '{}');

        if (settings.theme === 'dark' ||
           ((settings.theme === 'system' || settings.theme == null) &&
             window.matchMedia('(prefers-color-scheme: dark)').matches)
           ) {
          document.body.classList.add('dark')
        }
      } catch (error) { }
    </script>

<div class="body-wrapper">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

      <div>
        <a href="readme.html" class="sidebar-projectName" translate="no">
hb
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v0.0.1
        </div>
      </div>
    </div>
    <ul id="sidebar-listNav" class="sidebar-listNav" role="tablist">
      <li>
        <button id="extras-list-tab-button" role="tab" data-type="extras" aria-controls="extras-tab-panel" aria-selected="true" tabindex="0">
Pages
        </button>
      </li>

        <li>
          <button id="modules-list-tab-button" role="tab" data-type="modules" aria-controls="modules-tab-panel" aria-selected="false" tabindex="-1">
            Modules
          </button>
        </li>


    </ul>
  </div>

  <div id="extras-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="extras-list-tab-button">
    <ul id="extras-full-list" class="full-list"></ul>
  </div>

    <div id="modules-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="modules-list-tab-button" hidden>
      <ul id="modules-full-list" class="full-list"></ul>
    </div>


</nav>

<main class="content">
  <output role="status" id="toast"></output>

  <div id="content" class="content-inner">
    <div class="top-search">
      <div class="search-settings">
        <form class="search-bar" action="search.html">
          <label class="search-label">
            <span class="sr-only">Search documentation of hb</span>
            <input name="q" type="text" class="search-input" placeholder="Press / to search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </label>
          <button type="submit" class="search-button" aria-label="Submit Search">
            <i class="ri-search-2-line ri-lg" aria-hidden="true" title="Submit search"></i>
          </button>
          <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
            <i class="ri-close-line ri-lg" title="Cancel search"></i>
          </button>
        </form>
        <div class="autocomplete">
        </div>
        <button class="icon-settings display-settings">
          <i class="ri-settings-3-line"></i>
          <span class="sr-only">Settings</span>
        </button>
      </div>
    </div>

<div id="top-content">
  <h1>

      <a href="https://github.com/permaweb/HyperBEAM/blob/v0.0.1/src/dev_green_zone.erl#L1" title="View Source" class="icon-action" rel="help">
        <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        <span class="sr-only">View Source</span>
      </a>

    <span translate="no">dev_green_zone</span> 
    <small class="app-vsn" translate="no">(hb v0.0.1)</small>

  </h1>


    <section id="moduledoc">
<p>The green zone device, which provides secure communication and identity
management between trusted nodes. It handles node initialization, joining
existing green zones, key exchange, and node identity cloning. All operations
are protected by hardware commitment and encryption.</p>
    </section>

</div>

  <section id="summary" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#summary">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Summary</span>
    </h1>
<div class="summary-functions summary">
  <h2>
    <a href="#functions">Functions</a>
  </h2>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#become/3" data-no-tooltip translate="no">become(M1, M2, Opts)</a>

      </div>

        <div class="summary-synopsis"><p>Clone the identity of a target node.
Allows a node to adopt the identity of a target node by retrieving the target
node's encrypted private key and IV, decrypting it using the shared AES key,
and updating the local node's wallet with the target node's keypair.
@param M1 The message containing the target node's encrypted private key and IV.
@param M2 Ignored parameter.
@param Opts A map of configuration options. Must include <code class="inline">priv_green_zone_aes</code>.
@returns {ok, Map} on success, where Map includes</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#init/3" data-no-tooltip translate="no">init(M1, M2, Opts)</a>

      </div>

        <div class="summary-synopsis"><p>Initialize the green zone.
Sets up the node's cryptographic identity by ensuring that a wallet (keypair)
exists and generating a shared AES key for secure communication. The wallet,
AES key, and an empty trusted nodes list are stored in the node's configuration.
@param M1 Ignored parameter.
@param M2 Optionally contains a <code class="inline">required-config</code> map. If not provided, the</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#join/3" data-no-tooltip translate="no">join(M1, M2, Opts)</a>

      </div>

        <div class="summary-synopsis"><p>Initiate the join process for a node (Node B).</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#key/3" data-no-tooltip translate="no">key(M1, M2, Opts)</a>

      </div>

        <div class="summary-synopsis"><p>Retrieve and encrypt the node's private key.
Encrypts the node's private key using the shared AES key in AES-256-GCM mode. 
It returns the encrypted key along with the initialization vector (IV) needed
for decryption.
@param M1 Ignored parameter.
@param M2 Ignored parameter.
@param Opts A map of configuration options. Must include keys <code class="inline">priv_wallet</code></p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#rsa_wallet_integration_test/0" data-no-tooltip translate="no">rsa_wallet_integration_test()</a>

      </div>

        <div class="summary-synopsis"><p>Test RSA operations with the existing wallet structure.
This test function verifies that encryption and decryption using the RSA keys
from the wallet work correctly. It creates a new wallet, encrypts a test
message with the RSA public key, and then decrypts it with the RSA private
key, asserting that the decrypted message matches the original.</p></div>

    </div>

</div>

  </section>


  <section id="functions" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#functions">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Functions</span>
    </h1>
    <div class="functions-list">
<section class="detail" id="become/3">

  <div class="detail-header">
    <a href="#become/3" class="detail-link" data-no-tooltip aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <h1 class="signature" translate="no">become(M1, M2, Opts)</h1>

      <a href="https://github.com/permaweb/HyperBEAM/blob/v0.0.1/src/dev_green_zone.erl#L196" class="icon-action" rel="help" aria-label="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
     </a>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> become(M1 :: <a href="https://www.erlang.org/doc/apps/erts/erlang.html#t:term/0">term</a>(), M2 :: <a href="https://www.erlang.org/doc/apps/erts/erlang.html#t:term/0">term</a>(), Opts :: <a href="https://www.erlang.org/doc/apps/erts/erlang.html#t:map/0">map</a>()) -> {ok, <a href="https://www.erlang.org/doc/apps/erts/erlang.html#t:map/0">map</a>()} | {error, <a href="https://www.erlang.org/doc/apps/erts/erlang.html#t:binary/0">binary</a>()}.</pre>

      </div>

<p>Clone the identity of a target node.
Allows a node to adopt the identity of a target node by retrieving the target
node's encrypted private key and IV, decrypting it using the shared AES key,
and updating the local node's wallet with the target node's keypair.
@param M1 The message containing the target node's encrypted private key and IV.
@param M2 Ignored parameter.
@param Opts A map of configuration options. Must include <code class="inline">priv_green_zone_aes</code>.
@returns {ok, Map} on success, where Map includes:</p><pre><code class="makeup erlang" translate="no"><span class="w">      </span><span class="p">-</span><span class="w"> </span><span class="na">status</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
</span><span class="w">      </span><span class="p">-</span><span class="w"> </span><span class="na">message</span><span class="p">:</span><span class="w"> </span><span class="ss">confirmation</span><span class="w"> </span><span class="ss">text</span><span class="w">
</span><span class="w">      </span><span class="p">-</span><span class="w"> </span><span class="na">node</span><span class="p">:</span><span class="w"> </span><span class="ss">the</span><span class="w"> </span><span class="ss">target</span><span class="w"> </span><span class="nb">node</span><span class="err">&#39;</span><span class="ss">s</span><span class="w"> </span><span class="ss">address</span><span class="w">
     </span><span class="n">Returns</span><span class="w"> </span><span class="p" data-group-id="4778069761-1">{</span><span class="ss">error</span><span class="p">,</span><span class="w"> </span><span class="n">Reason</span><span class="p" data-group-id="4778069761-1">}</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="ss">the</span><span class="w"> </span><span class="nb">node</span><span class="w"> </span><span class="ss">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="ss">part</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="ss">the</span><span class="w"> </span><span class="ss">green</span><span class="w"> </span><span class="ss">zone</span><span class="p">.</span></code></pre>
  </section>
</section>
<section class="detail" id="init/3">

  <div class="detail-header">
    <a href="#init/3" class="detail-link" data-no-tooltip aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <h1 class="signature" translate="no">init(M1, M2, Opts)</h1>

      <a href="https://github.com/permaweb/HyperBEAM/blob/v0.0.1/src/dev_green_zone.erl#L57" class="icon-action" rel="help" aria-label="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
     </a>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> init(M1 :: <a href="https://www.erlang.org/doc/apps/erts/erlang.html#t:term/0">term</a>(), M2 :: <a href="https://www.erlang.org/doc/apps/erts/erlang.html#t:term/0">term</a>(), Opts :: <a href="https://www.erlang.org/doc/apps/erts/erlang.html#t:map/0">map</a>()) -> {ok, <a href="https://www.erlang.org/doc/apps/erts/erlang.html#t:binary/0">binary</a>()}.</pre>

      </div>

<p>Initialize the green zone.
Sets up the node's cryptographic identity by ensuring that a wallet (keypair)
exists and generating a shared AES key for secure communication. The wallet,
AES key, and an empty trusted nodes list are stored in the node's configuration.
@param M1 Ignored parameter.
@param M2 Optionally contains a <code class="inline">required-config</code> map. If not provided, the</p><pre><code class="makeup erlang" translate="no"><span class="w">      </span><span class="ss">default</span><span class="w"> </span><span class="ss">required</span><span class="w"> </span><span class="nf">config</span><span class="w"> </span><span class="p" data-group-id="2811720220-1">(</span><span class="ss">derived</span><span class="w"> </span><span class="ss">from</span><span class="w"> </span><span class="ss">the</span><span class="w"> </span><span class="nb">nodes</span><span class="w"> </span><span class="ss">base</span><span class="w"> </span><span class="ss">configuration</span><span class="p" data-group-id="2811720220-1">)</span><span class="w">
      </span><span class="ss">will</span><span class="w"> </span><span class="ss">be</span><span class="w"> </span><span class="ss">used</span><span class="p">.</span></code></pre><p>@param Opts A map containing configuration options. If the wallet is not already</p><pre><code class="makeup erlang" translate="no"><span class="w">        </span><span class="nf">provided</span><span class="w"> </span><span class="p" data-group-id="8580321028-1">(</span><span class="ss">under</span><span class="w"> </span><span class="ss">key</span><span class="w"> </span><span class="err">`</span><span class="ss">priv_wallet</span><span class="err">`</span><span class="p" data-group-id="8580321028-1">)</span><span class="p">,</span><span class="w"> </span><span class="ss">a</span><span class="w"> </span><span class="ss">new</span><span class="w"> </span><span class="ss">one</span><span class="w"> </span><span class="ss">will</span><span class="w"> </span><span class="ss">be</span><span class="w"> </span><span class="ss">created</span><span class="p">.</span></code></pre><p>@returns {ok, Msg} where Msg is a binary confirmation message.</p>
  </section>
</section>
<section class="detail" id="join/3">

  <div class="detail-header">
    <a href="#join/3" class="detail-link" data-no-tooltip aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <h1 class="signature" translate="no">join(M1, M2, Opts)</h1>

      <a href="https://github.com/permaweb/HyperBEAM/blob/v0.0.1/src/dev_green_zone.erl#L120" class="icon-action" rel="help" aria-label="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
     </a>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> join(M1 :: <a href="https://www.erlang.org/doc/apps/erts/erlang.html#t:term/0">term</a>(), M2 :: <a href="https://www.erlang.org/doc/apps/erts/erlang.html#t:term/0">term</a>(), Opts :: <a href="https://www.erlang.org/doc/apps/erts/erlang.html#t:map/0">map</a>()) -> {ok, <a href="https://www.erlang.org/doc/apps/erts/erlang.html#t:map/0">map</a>()} | {error, <a href="https://www.erlang.org/doc/apps/erts/erlang.html#t:binary/0">binary</a>()}.</pre>

      </div>

<p>Initiate the join process for a node (Node B).</p><p>When Node B wishes to join an existing green zone, it sends a GET request to
its local join endpoint.
This request includes a header with the target peer's address (Node A).</p><p>Based on the presence of a peer address:</p><ul><li>If the target peer is specified, Node B internally routes the request to 
the join_peer flow, where it generates an commitment report and prepares
a POST request to forward to Node A.</li><li>If no peer address is present, the join request is processed locally via
the validate_join flow.</li></ul><p>@param M1 The join request message containing a header with the target peer's</p><pre><code class="makeup erlang" translate="no"><span class="w">      </span><span class="ss">address</span><span class="p">.</span></code></pre><p>@param M2 Ignored parameter.
@param Opts A map of configuration options.
@returns {ok, Map} on success with join response details, or {error, Reason}
on failure.</p>
  </section>
</section>
<section class="detail" id="key/3">

  <div class="detail-header">
    <a href="#key/3" class="detail-link" data-no-tooltip aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <h1 class="signature" translate="no">key(M1, M2, Opts)</h1>

      <a href="https://github.com/permaweb/HyperBEAM/blob/v0.0.1/src/dev_green_zone.erl#L148" class="icon-action" rel="help" aria-label="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
     </a>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">-spec</span> key(M1 :: <a href="https://www.erlang.org/doc/apps/erts/erlang.html#t:term/0">term</a>(), M2 :: <a href="https://www.erlang.org/doc/apps/erts/erlang.html#t:term/0">term</a>(), Opts :: <a href="https://www.erlang.org/doc/apps/erts/erlang.html#t:map/0">map</a>()) -> {ok, <a href="https://www.erlang.org/doc/apps/erts/erlang.html#t:map/0">map</a>()} | {error, <a href="https://www.erlang.org/doc/apps/erts/erlang.html#t:binary/0">binary</a>()}.</pre>

      </div>

<p>Retrieve and encrypt the node's private key.
Encrypts the node's private key using the shared AES key in AES-256-GCM mode. 
It returns the encrypted key along with the initialization vector (IV) needed
for decryption.
@param M1 Ignored parameter.
@param M2 Ignored parameter.
@param Opts A map of configuration options. Must include keys <code class="inline">priv_wallet</code></p><pre><code class="makeup erlang" translate="no"><span class="w">        </span><span class="ow">and</span><span class="w"> </span><span class="err">`</span><span class="ss">priv_green_zone_aes</span><span class="err">`</span><span class="p">.</span></code></pre><p>@returns {ok, Map} on success, where Map contains:</p><pre><code class="makeup erlang" translate="no"><span class="w">      </span><span class="p">-</span><span class="w"> </span><span class="na">status</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
</span><span class="w">      </span><span class="p">-</span><span class="w"> </span><span class="na">encrypted_key</span><span class="p">:</span><span class="w"> </span><span class="ss">the</span><span class="w"> </span><span class="ss">encrypted</span><span class="w"> </span><span class="ss">private</span><span class="w"> </span><span class="nf">key</span><span class="w"> </span><span class="p" data-group-id="5224793750-1">(</span><span class="n">Base64</span><span class="w"> </span><span class="ss">encoded</span><span class="p" data-group-id="5224793750-1">)</span><span class="w">
</span><span class="w">      </span><span class="p">-</span><span class="w"> </span><span class="na">iv</span><span class="p">:</span><span class="w"> </span><span class="ss">the</span><span class="w"> </span><span class="ss">initialization</span><span class="w"> </span><span class="nf">vector</span><span class="w"> </span><span class="p" data-group-id="5224793750-2">(</span><span class="n">Base64</span><span class="w"> </span><span class="ss">encoded</span><span class="p" data-group-id="5224793750-2">)</span><span class="w">
     </span><span class="n">Returns</span><span class="w"> </span><span class="p" data-group-id="5224793750-3">{</span><span class="ss">error</span><span class="p">,</span><span class="w"> </span><span class="n">Reason</span><span class="p" data-group-id="5224793750-3">}</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="ss">the</span><span class="w"> </span><span class="nb">node</span><span class="w"> </span><span class="ss">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="ss">part</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="ss">the</span><span class="w"> </span><span class="ss">green</span><span class="w"> </span><span class="ss">zone</span><span class="p">.</span></code></pre>
  </section>
</section>
<section class="detail" id="rsa_wallet_integration_test/0">

  <div class="detail-header">
    <a href="#rsa_wallet_integration_test/0" class="detail-link" data-no-tooltip aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <h1 class="signature" translate="no">rsa_wallet_integration_test()</h1>

      <a href="https://github.com/permaweb/HyperBEAM/blob/v0.0.1/src/dev_green_zone.erl#L656" class="icon-action" rel="help" aria-label="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
     </a>


  </div>

  <section class="docstring">

<p>Test RSA operations with the existing wallet structure.
This test function verifies that encryption and decryption using the RSA keys
from the wallet work correctly. It creates a new wallet, encrypts a test
message with the RSA public key, and then decrypts it with the RSA private
key, asserting that the decrypted message matches the original.</p>
  </section>
</section>

    </div>
  </section>

    <footer class="footer">
      <p>

          <span class="line">
            <a href="https://hex.pm/packages/hb/0.0.1" class="footer-hex-package">Hex Package</a>

            <a href="https://preview.hex.pm/preview/hb/0.0.1">Hex Preview</a>

          </span>

        <span class="line">
          <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
            Search HexDocs
          </button>

            <a href="hb.epub" title="ePub version">
              Download ePub version
            </a>

        </span>
      </p>

      <p class="built-using">
        Built using
        <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.35.1) for the

          <a href="https://erlang.org" title="Erlang" target="_blank" translate="no">Erlang programming language</a>

      </p>

    </footer>
  </div>
</main>
</div>

  </body>
</html>
