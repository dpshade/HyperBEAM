<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.35.1">
    <meta name="project" content="hb v0.0.1">


    <title>hb_persistent â€” hb v0.0.1</title>
    <link rel="stylesheet" href="dist/html-erlang-4IXSOGMD.css" />


    <script src="dist/handlebars.runtime-NWIB6V2M.js"></script>
    <script src="dist/handlebars.templates-K7URE6B4.js"></script>
    <script src="dist/sidebar_items-BF2C6ECE.js"></script>
    <script src="docs_config.js"></script>
    <script async src="dist/html-PVRIOB7F.js"></script>

  </head>
  <body data-type="modules" class="page-module">
    <script>

      try {
        var settings = JSON.parse(localStorage.getItem('ex_doc:settings') || '{}');

        if (settings.theme === 'dark' ||
           ((settings.theme === 'system' || settings.theme == null) &&
             window.matchMedia('(prefers-color-scheme: dark)').matches)
           ) {
          document.body.classList.add('dark')
        }
      } catch (error) { }
    </script>

<div class="body-wrapper">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

      <div>
        <a href="readme.html" class="sidebar-projectName" translate="no">
hb
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v0.0.1
        </div>
      </div>
    </div>
    <ul id="sidebar-listNav" class="sidebar-listNav" role="tablist">
      <li>
        <button id="extras-list-tab-button" role="tab" data-type="extras" aria-controls="extras-tab-panel" aria-selected="true" tabindex="0">
Pages
        </button>
      </li>

        <li>
          <button id="modules-list-tab-button" role="tab" data-type="modules" aria-controls="modules-tab-panel" aria-selected="false" tabindex="-1">
            Modules
          </button>
        </li>


    </ul>
  </div>

  <div id="extras-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="extras-list-tab-button">
    <ul id="extras-full-list" class="full-list"></ul>
  </div>

    <div id="modules-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="modules-list-tab-button" hidden>
      <ul id="modules-full-list" class="full-list"></ul>
    </div>


</nav>

<main class="content">
  <output role="status" id="toast"></output>

  <div id="content" class="content-inner">
    <div class="top-search">
      <div class="search-settings">
        <form class="search-bar" action="search.html">
          <label class="search-label">
            <span class="sr-only">Search documentation of hb</span>
            <input name="q" type="text" class="search-input" placeholder="Press / to search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </label>
          <button type="submit" class="search-button" aria-label="Submit Search">
            <i class="ri-search-2-line ri-lg" aria-hidden="true" title="Submit search"></i>
          </button>
          <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
            <i class="ri-close-line ri-lg" title="Cancel search"></i>
          </button>
        </form>
        <div class="autocomplete">
        </div>
        <button class="icon-settings display-settings">
          <i class="ri-settings-3-line"></i>
          <span class="sr-only">Settings</span>
        </button>
      </div>
    </div>

<div id="top-content">
  <h1>

      <a href="https://github.com/permaweb/HyperBEAM/blob/v0.0.1/src/hb_persistent.erl#L1" title="View Source" class="icon-action" rel="help">
        <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        <span class="sr-only">View Source</span>
      </a>

    <span translate="no">hb_persistent</span> 
    <small class="app-vsn" translate="no">(hb v0.0.1)</small>

  </h1>


    <section id="moduledoc">
<p>Creates and manages long-lived AO-Core resolution processes.
These can be useful for situations where a message is large and expensive
to serialize and deserialize, or when executions should be deliberately
serialized to avoid parallel executions of the same computation. This 
module is called during the core <code class="inline">hb_ao</code> execution process, so care
must be taken to avoid recursive spawns/loops.</p><p>Built using the <code class="inline">pg</code> module, which is a distributed Erlang process group
manager.</p>
    </section>

</div>

  <section id="summary" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#summary">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Summary</span>
    </h1>
<div class="summary-functions summary">
  <h2>
    <a href="#functions">Functions</a>
  </h2>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#await/4" data-no-tooltip translate="no">await(Worker, Msg1, Msg2, Opts)</a>

      </div>

        <div class="summary-synopsis"><p>If there was already an Erlang process handling this execution,
we should register with them and wait for them to notify us of
completion.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#deduplicated_execution_test/0" data-no-tooltip translate="no">deduplicated_execution_test()</a>

      </div>

        <div class="summary-synopsis"><p>Test merging and returning a value with a persistent worker.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#default_await/5" data-no-tooltip translate="no">default_await(Worker, GroupName, Msg1, Msg2, Opts)</a>

      </div>

        <div class="summary-synopsis"><p>Default await function that waits for a resolution from a worker.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#default_grouper/3" data-no-tooltip translate="no">default_grouper(Msg1, Msg2, Opts)</a>

      </div>

        <div class="summary-synopsis"><p>Create a group name from a Msg1 and Msg2 pair as a tuple.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#default_worker/3" data-no-tooltip translate="no">default_worker(GroupName, Msg1, Opts)</a>

      </div>

        <div class="summary-synopsis"><p>A server function for handling persistent executions.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#find_or_register/3" data-no-tooltip translate="no">find_or_register(Msg1, Msg2, Opts)</a>

      </div>

        <div class="summary-synopsis"><p>Register the process to lead an execution if none is found, otherwise
signal that we should await resolution.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#forward_work/2" data-no-tooltip translate="no">forward_work(NewPID, Opts)</a>

      </div>

        <div class="summary-synopsis"><p>Forward requests to a newly delegated execution process.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#group/3" data-no-tooltip translate="no">group(Msg1, Msg2, Opts)</a>

      </div>

        <div class="summary-synopsis"><p>Calculate the group name for a Msg1 and Msg2 pair. Uses the Msg1's
<code class="inline">group</code> function if it is found in the <code class="inline">info</code>, otherwise uses the default.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#notify/4" data-no-tooltip translate="no">notify(GroupName, Msg2, Msg3, Opts)</a>

      </div>

        <div class="summary-synopsis"><p>Check our inbox for processes that are waiting for the resolution
of this execution. Comes in two forms</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#persistent_worker_test/0" data-no-tooltip translate="no">persistent_worker_test()</a>

      </div>

        <div class="summary-synopsis"><p>Test spawning a default persistent worker.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#spawn_after_execution_test/0" data-no-tooltip translate="no">spawn_after_execution_test()</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#start_monitor/0" data-no-tooltip translate="no">start_monitor()</a>

      </div>

        <div class="summary-synopsis"><p>Start a monitor that prints the current members of the group every
n seconds.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#start_monitor/1" data-no-tooltip translate="no">start_monitor(Group)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#start_worker/2" data-no-tooltip translate="no">start_worker(Msg, Opts)</a>

      </div>

        <div class="summary-synopsis"><p>Start a worker process that will hold a message in memory for
future executions.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#start_worker/3" data-no-tooltip translate="no">start_worker/3</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#stop_monitor/1" data-no-tooltip translate="no">stop_monitor(PID)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#unregister_notify/4" data-no-tooltip translate="no">unregister_notify/4</a>

      </div>

        <div class="summary-synopsis"><p>Unregister as the leader for an execution and notify waiting processes.</p></div>

    </div>

</div>

  </section>


  <section id="functions" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#functions">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Functions</span>
    </h1>
    <div class="functions-list">
<section class="detail" id="await/4">

  <div class="detail-header">
    <a href="#await/4" class="detail-link" data-no-tooltip aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <h1 class="signature" translate="no">await(Worker, Msg1, Msg2, Opts)</h1>

      <a href="https://github.com/permaweb/HyperBEAM/blob/v0.0.1/src/hb_persistent.erl#L184" class="icon-action" rel="help" aria-label="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
     </a>


  </div>

  <section class="docstring">

<p>If there was already an Erlang process handling this execution,
we should register with them and wait for them to notify us of
completion.</p>
  </section>
</section>
<section class="detail" id="deduplicated_execution_test/0">

  <div class="detail-header">
    <a href="#deduplicated_execution_test/0" class="detail-link" data-no-tooltip aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <h1 class="signature" translate="no">deduplicated_execution_test()</h1>

      <a href="https://github.com/permaweb/HyperBEAM/blob/v0.0.1/src/hb_persistent.erl#L480" class="icon-action" rel="help" aria-label="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
     </a>


  </div>

  <section class="docstring">

<p>Test merging and returning a value with a persistent worker.</p>
  </section>
</section>
<section class="detail" id="default_await/5">

  <div class="detail-header">
    <a href="#default_await/5" class="detail-link" data-no-tooltip aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <h1 class="signature" translate="no">default_await(Worker, GroupName, Msg1, Msg2, Opts)</h1>

      <a href="https://github.com/permaweb/HyperBEAM/blob/v0.0.1/src/hb_persistent.erl#L203" class="icon-action" rel="help" aria-label="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
     </a>


  </div>

  <section class="docstring">

<p>Default await function that waits for a resolution from a worker.</p>
  </section>
</section>
<section class="detail" id="default_grouper/3">

  <div class="detail-header">
    <a href="#default_grouper/3" class="detail-link" data-no-tooltip aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <h1 class="signature" translate="no">default_grouper(Msg1, Msg2, Opts)</h1>

      <a href="https://github.com/permaweb/HyperBEAM/blob/v0.0.1/src/hb_persistent.erl#L391" class="icon-action" rel="help" aria-label="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
     </a>


  </div>

  <section class="docstring">

<p>Create a group name from a Msg1 and Msg2 pair as a tuple.</p>
  </section>
</section>
<section class="detail" id="default_worker/3">

  <div class="detail-header">
    <a href="#default_worker/3" class="detail-link" data-no-tooltip aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <h1 class="signature" translate="no">default_worker(GroupName, Msg1, Opts)</h1>

      <a href="https://github.com/permaweb/HyperBEAM/blob/v0.0.1/src/hb_persistent.erl#L338" class="icon-action" rel="help" aria-label="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
     </a>


  </div>

  <section class="docstring">

<p>A server function for handling persistent executions.</p>
  </section>
</section>
<section class="detail" id="find_or_register/3">

  <div class="detail-header">
    <a href="#find_or_register/3" class="detail-link" data-no-tooltip aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <h1 class="signature" translate="no">find_or_register(Msg1, Msg2, Opts)</h1>

      <a href="https://github.com/permaweb/HyperBEAM/blob/v0.0.1/src/hb_persistent.erl#L109" class="icon-action" rel="help" aria-label="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
     </a>


  </div>

  <section class="docstring">

<p>Register the process to lead an execution if none is found, otherwise
signal that we should await resolution.</p>
  </section>
</section>
<section class="detail" id="forward_work/2">

  <div class="detail-header">
    <a href="#forward_work/2" class="detail-link" data-no-tooltip aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <h1 class="signature" translate="no">forward_work(NewPID, Opts)</h1>

      <a href="https://github.com/permaweb/HyperBEAM/blob/v0.0.1/src/hb_persistent.erl#L247" class="icon-action" rel="help" aria-label="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
     </a>


  </div>

  <section class="docstring">

<p>Forward requests to a newly delegated execution process.</p>
  </section>
</section>
<section class="detail" id="group/3">

  <div class="detail-header">
    <a href="#group/3" class="detail-link" data-no-tooltip aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <h1 class="signature" translate="no">group(Msg1, Msg2, Opts)</h1>

      <a href="https://github.com/permaweb/HyperBEAM/blob/v0.0.1/src/hb_persistent.erl#L154" class="icon-action" rel="help" aria-label="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
     </a>


  </div>

  <section class="docstring">

<p>Calculate the group name for a Msg1 and Msg2 pair. Uses the Msg1's
<code class="inline">group</code> function if it is found in the <code class="inline">info</code>, otherwise uses the default.</p>
  </section>
</section>
<section class="detail" id="notify/4">

  <div class="detail-header">
    <a href="#notify/4" class="detail-link" data-no-tooltip aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <h1 class="signature" translate="no">notify(GroupName, Msg2, Msg3, Opts)</h1>

      <a href="https://github.com/permaweb/HyperBEAM/blob/v0.0.1/src/hb_persistent.erl#L227" class="icon-action" rel="help" aria-label="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
     </a>


  </div>

  <section class="docstring">

<p>Check our inbox for processes that are waiting for the resolution
of this execution. Comes in two forms:</p><ol><li>Notify on group name alone.</li><li>Notify on group name and Msg2.</li></ol>
  </section>
</section>
<section class="detail" id="persistent_worker_test/0">

  <div class="detail-header">
    <a href="#persistent_worker_test/0" class="detail-link" data-no-tooltip aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <h1 class="signature" translate="no">persistent_worker_test()</h1>

      <a href="https://github.com/permaweb/HyperBEAM/blob/v0.0.1/src/hb_persistent.erl#L499" class="icon-action" rel="help" aria-label="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
     </a>


  </div>

  <section class="docstring">

<p>Test spawning a default persistent worker.</p>
  </section>
</section>
<section class="detail" id="spawn_after_execution_test/0">

  <div class="detail-header">
    <a href="#spawn_after_execution_test/0" class="detail-link" data-no-tooltip aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <h1 class="signature" translate="no">spawn_after_execution_test()</h1>

      <a href="https://github.com/permaweb/HyperBEAM/blob/v0.0.1/src/hb_persistent.erl#L519" class="icon-action" rel="help" aria-label="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
     </a>


  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="start_monitor/0">

  <div class="detail-header">
    <a href="#start_monitor/0" class="detail-link" data-no-tooltip aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <h1 class="signature" translate="no">start_monitor()</h1>

      <a href="https://github.com/permaweb/HyperBEAM/blob/v0.0.1/src/hb_persistent.erl#L30" class="icon-action" rel="help" aria-label="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
     </a>


  </div>

  <section class="docstring">

<p>Start a monitor that prints the current members of the group every
n seconds.</p>
  </section>
</section>
<section class="detail" id="start_monitor/1">

  <div class="detail-header">
    <a href="#start_monitor/1" class="detail-link" data-no-tooltip aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <h1 class="signature" translate="no">start_monitor(Group)</h1>

      <a href="https://github.com/permaweb/HyperBEAM/blob/v0.0.1/src/hb_persistent.erl#L32" class="icon-action" rel="help" aria-label="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
     </a>


  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="start_worker/2">

  <div class="detail-header">
    <a href="#start_worker/2" class="detail-link" data-no-tooltip aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <h1 class="signature" translate="no">start_worker(Msg, Opts)</h1>

      <a href="https://github.com/permaweb/HyperBEAM/blob/v0.0.1/src/hb_persistent.erl#L286" class="icon-action" rel="help" aria-label="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
     </a>


  </div>

  <section class="docstring">

<p>Start a worker process that will hold a message in memory for
future executions.</p>
  </section>
</section>
<section class="detail" id="start_worker/3">

  <div class="detail-header">
    <a href="#start_worker/3" class="detail-link" data-no-tooltip aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <h1 class="signature" translate="no">start_worker/3</h1>

      <a href="https://github.com/permaweb/HyperBEAM/blob/v0.0.1/src/hb_persistent.erl#L288" class="icon-action" rel="help" aria-label="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
     </a>


  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="stop_monitor/1">

  <div class="detail-header">
    <a href="#stop_monitor/1" class="detail-link" data-no-tooltip aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <h1 class="signature" translate="no">stop_monitor(PID)</h1>

      <a href="https://github.com/permaweb/HyperBEAM/blob/v0.0.1/src/hb_persistent.erl#L37" class="icon-action" rel="help" aria-label="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
     </a>


  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="unregister_notify/4">

  <div class="detail-header">
    <a href="#unregister_notify/4" class="detail-link" data-no-tooltip aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <h1 class="signature" translate="no">unregister_notify/4</h1>

      <a href="https://github.com/permaweb/HyperBEAM/blob/v0.0.1/src/hb_persistent.erl#L135" class="icon-action" rel="help" aria-label="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
     </a>


  </div>

  <section class="docstring">

<p>Unregister as the leader for an execution and notify waiting processes.</p>
  </section>
</section>

    </div>
  </section>

    <footer class="footer">
      <p>

          <span class="line">
            <a href="https://hex.pm/packages/hb/0.0.1" class="footer-hex-package">Hex Package</a>

            <a href="https://preview.hex.pm/preview/hb/0.0.1">Hex Preview</a>

          </span>

        <span class="line">
          <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
            Search HexDocs
          </button>

            <a href="hb.epub" title="ePub version">
              Download ePub version
            </a>

        </span>
      </p>

      <p class="built-using">
        Built using
        <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.35.1) for the

          <a href="https://erlang.org" title="Erlang" target="_blank" translate="no">Erlang programming language</a>

      </p>

    </footer>
  </div>
</main>
</div>

  </body>
</html>
