<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.35.1">
    <meta name="project" content="hb v0.0.1">


    <title>AO-Core HTTP API Design notes — hb v0.0.1</title>
    <link rel="stylesheet" href="dist/html-erlang-4IXSOGMD.css" />


    <script src="dist/handlebars.runtime-NWIB6V2M.js"></script>
    <script src="dist/handlebars.templates-K7URE6B4.js"></script>
    <script src="dist/sidebar_items-BF2C6ECE.js"></script>
    <script src="docs_config.js"></script>
    <script async src="dist/html-PVRIOB7F.js"></script>

  </head>
  <body data-type="extras" class="page-extra">
    <script>

      try {
        var settings = JSON.parse(localStorage.getItem('ex_doc:settings') || '{}');

        if (settings.theme === 'dark' ||
           ((settings.theme === 'system' || settings.theme == null) &&
             window.matchMedia('(prefers-color-scheme: dark)').matches)
           ) {
          document.body.classList.add('dark')
        }
      } catch (error) { }
    </script>

<div class="body-wrapper">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

      <div>
        <a href="readme.html" class="sidebar-projectName" translate="no">
hb
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v0.0.1
        </div>
      </div>
    </div>
    <ul id="sidebar-listNav" class="sidebar-listNav" role="tablist">
      <li>
        <button id="extras-list-tab-button" role="tab" data-type="extras" aria-controls="extras-tab-panel" aria-selected="true" tabindex="0">
Pages
        </button>
      </li>

        <li>
          <button id="modules-list-tab-button" role="tab" data-type="modules" aria-controls="modules-tab-panel" aria-selected="false" tabindex="-1">
            Modules
          </button>
        </li>


    </ul>
  </div>

  <div id="extras-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="extras-list-tab-button">
    <ul id="extras-full-list" class="full-list"></ul>
  </div>

    <div id="modules-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="modules-list-tab-button" hidden>
      <ul id="modules-full-list" class="full-list"></ul>
    </div>


</nav>

<main class="content">
  <output role="status" id="toast"></output>

  <div id="content" class="content-inner">
    <div class="top-search">
      <div class="search-settings">
        <form class="search-bar" action="search.html">
          <label class="search-label">
            <span class="sr-only">Search documentation of hb</span>
            <input name="q" type="text" class="search-input" placeholder="Press / to search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </label>
          <button type="submit" class="search-button" aria-label="Submit Search">
            <i class="ri-search-2-line ri-lg" aria-hidden="true" title="Submit search"></i>
          </button>
          <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
            <i class="ri-close-line ri-lg" title="Cancel search"></i>
          </button>
        </form>
        <div class="autocomplete">
        </div>
        <button class="icon-settings display-settings">
          <i class="ri-settings-3-line"></i>
          <span class="sr-only">Settings</span>
        </button>
      </div>
    </div>

<div id="top-content">
  <h1>

      <a href="https://github.com/permaweb/HyperBEAM/blob/v0.0.1/docs/ao-http-api.md#L1" title="View Source" class="icon-action" rel="help">
        <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        <span class="sr-only">View Source</span>
      </a>


    <span>AO-Core HTTP API Design notes</span>
  </h1>

<h3 id="date-11-jan-2025" class="section-heading">
  <a href="#date-11-jan-2025" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Date: 11 Jan, 2025.</span>
</h3>
<p>The AO-Core protocol is designed to layer a computation system on top of
HTTP Semantics. As such, it offers syntax for HTTP requests that allow users to
easily manipulate and traverse through the computation graph. This document
describes the semantics and syntax of the AO-Core HTTP API.</p><h2 id="semantics-and-syntax" class="section-heading">
  <a href="#semantics-and-syntax" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Semantics and syntax</span>
</h2>
<ul><li>All paths for typical computations start with a base hashpath:<pre><code class="makeup erlang" translate="no"><span class="n">GET</span><span class="w"> </span><span class="o">/</span><span class="ss">hashpath1</span><span class="o">/</span><span class="p">.</span><span class="p">.</span><span class="p">.</span></code></pre></li><li>All keys after the base are interpreted as AO-Core messages individually, in 
a chain. For example, <code class="inline">GET /hashpath1/key1/key2</code> is equivalent to:<pre><code class="makeup erlang" translate="no"><span class="n">GET</span><span class="w"> </span><span class="o">/</span><span class="nf">hashpath</span><span class="p" data-group-id="3145588852-1">(</span><span class="ss">hashpath1</span><span class="p">,</span><span class="w"> </span><span class="ss">key1</span><span class="p" data-group-id="3145588852-1">)</span><span class="o">/</span><span class="ss">key2</span></code></pre></li><li>Each path segment is interpreted as a key to resolve upon the message for the
resolution of the previous message. The <code class="inline">key</code> is taken as the full path for
that message during that resolution.</li><li>When AO-Core is not given a base hashpath (the first key is not a 43 character
base64URL encoded string), the request message is assumed to be its own base
message, with the path applied alone as the request (<code class="inline">Message2</code>).</li><li>Query parameters are treated as equivalent to headers.</li><li>When not otherwise specified, a query parameter or header is interpreted as
being present in all messages in the path, in addition to the path key.</li><li><code class="inline">+</code> in path segments delimits the <code class="inline">key</code> and an optional message dictionary. 
For example, <code class="inline">GET /hashpath1/key1+dict1=val1/key2</code> adds <code class="inline">dict1=val1</code> to the
message for the resolution of the <code class="inline">key1</code> key.</li><li><code class="inline">N.KeyName</code> in headers or query parameters is interpreted as <code class="inline">KeyName</code> in the
message dictionary for the resolution of the <code class="inline">N</code>th key.</li><li><code class="inline">Key~DevName</code> in a path segment is interpreted as executing the message with
the <code class="inline">Device</code> set to <code class="inline">DevName</code>.</li><li>A dictionary key of form <code class="inline">Key|Type</code> is interpreted as a type annotation for
<code class="inline">Key</code>, which can be used to parse the value of the key using HTTP Structured
Fields (RFC 8941).</li><li>Parentheses in key or path segments are interpreted as the result of the 
enclosed path, as if it were an independent invocation. For example, 
<code class="inline">GET /hashpath1/path2+key1=(/hashpath2/key2)</code> implies that <code class="inline">key1</code> in the 
message for the resolution of <code class="inline">path2</code> is the result of the invocation of 
<code class="inline">/hashpath2/key2</code>.</li></ul><h2 id="example-workflows" class="section-heading">
  <a href="#example-workflows" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Example workflows</span>
</h2>
<p>Get the current routes:</p><pre><code class="makeup erlang" translate="no"><span class="ss">curl</span><span class="w"> </span><span class="nc">http</span><span class="p">:</span><span class="o">/</span><span class="o">/</span><span class="nc">host</span><span class="p">:</span><span class="ss">port</span><span class="o">/</span><span class="n">Routes</span></code></pre><p>Set a route for a specific path:</p><pre><code class="makeup erlang" translate="no"><span class="ss">curl</span><span class="w"> </span><span class="o">-</span><span class="n">X</span><span class="w"> </span><span class="n">POST</span><span class="w"> </span><span class="nc">http</span><span class="p">:</span><span class="o">/</span><span class="o">/</span><span class="nc">host</span><span class="p">:</span><span class="ss">port</span><span class="o">/</span><span class="n">Routes</span><span class="w"> </span><span class="o">-</span><span class="n">H</span><span class="w"> </span><span class="s">&quot;Priority: 10&quot;</span><span class="w"> </span><span class="err">\</span><span class="w">
    </span><span class="o">-</span><span class="n">H</span><span class="w"> </span><span class="s">&quot;Node: http://host:port&quot;</span><span class="w"> </span><span class="o">-</span><span class="n">H</span><span class="w"> </span><span class="s">&quot;Template: /Some/New/Path&quot;</span></code></pre><p>Schedule a message on a process:</p><pre><code class="makeup erlang" translate="no"><span class="ss">curl</span><span class="w"> </span><span class="o">-</span><span class="n">X</span><span class="w"> </span><span class="n">POST</span><span class="w"> </span><span class="nc">http</span><span class="p">:</span><span class="o">/</span><span class="o">/</span><span class="nc">host</span><span class="p">:</span><span class="ss">port</span><span class="o">/</span><span class="n">ProcID</span><span class="o">/</span><span class="n">Schedule</span><span class="w"> </span><span class="o">-</span><span class="n">H</span><span class="w"> </span><span class="s">&quot;Action: Transfer&quot;</span><span class="w"> </span><span class="err">\</span><span class="w">
    </span><span class="o">-</span><span class="n">H</span><span class="w"> </span><span class="s">&quot;Recipient: Address&quot;</span><span class="w"> </span><span class="o">-</span><span class="n">H</span><span class="w"> </span><span class="s">&quot;Quantity: 1337&quot;</span></code></pre><p>Run a WASM executable:</p><pre><code class="makeup erlang" translate="no"><span class="ss">curl</span><span class="w"> </span><span class="o">-</span><span class="n">X</span><span class="w"> </span><span class="n">POST</span><span class="w"> </span><span class="nc">http</span><span class="p">:</span><span class="o">/</span><span class="o">/</span><span class="nc">host</span><span class="p">:</span><span class="ss">port</span><span class="o">/</span><span class="n">Init</span><span class="o">/</span><span class="n">Compute</span><span class="w"> </span><span class="o">-</span><span class="n">H</span><span class="w"> </span><span class="s">&quot;Device: WASM-64/1.0&quot;</span><span class="w"> </span><span class="err">\</span><span class="w">
    </span><span class="o">-</span><span class="n">H</span><span class="w"> </span><span class="s">&quot;2.WASM-Function: fac&quot;</span><span class="w"> </span><span class="o">-</span><span class="n">H</span><span class="w"> </span><span class="s">&quot;2.WASM-Params: [10]&quot;</span><span class="w"> </span><span class="o">-</span><span class="ss">d</span><span class="w"> </span><span class="p">@</span><span class="ss">test</span><span class="o">/</span><span class="ss">test</span><span class="o">-</span><span class="mi">64</span><span class="p">.</span><span class="ss">wasm</span></code></pre><p>...returning response with a <code class="inline">Hashpath</code> header. To execute further messages
on the result, use the <code class="inline">Hashpath</code> as the base hashpath for the next message:</p><pre><code class="makeup erlang" translate="no"><span class="ss">curl</span><span class="w"> </span><span class="nc">http</span><span class="p">:</span><span class="o">/</span><span class="o">/</span><span class="nc">host</span><span class="p">:</span><span class="ss">port</span><span class="o">/</span><span class="n">Hashpath</span><span class="o">/</span><span class="n">Compute</span><span class="o">/</span><span class="n">Results</span><span class="w"> </span><span class="o">-</span><span class="n">H</span><span class="w"> </span><span class="s">&quot;WASM-Function: fac&quot;</span><span class="w"> </span><span class="err">\</span><span class="w">
    </span><span class="o">-</span><span class="n">H</span><span class="w"> </span><span class="s">&quot;WASM-Params: [11]&quot;</span><span class="w"> </span><span class="o">-</span><span class="ss">d</span><span class="w"> </span><span class="p">@</span><span class="ss">test</span><span class="o">/</span><span class="ss">test</span><span class="o">-</span><span class="mi">64</span><span class="p">.</span><span class="ss">wasm</span></code></pre><p>Assign a message from one process's outbox to the schedule of another:</p><pre><code class="makeup erlang" translate="no"><span class="ss">curl</span><span class="w"> </span><span class="o">-</span><span class="n">X</span><span class="w"> </span><span class="n">POST</span><span class="w"> </span><span class="nc">http</span><span class="p">:</span><span class="o">/</span><span class="o">/</span><span class="nc">host</span><span class="p">:</span><span class="ss">port</span><span class="o">/</span><span class="n">ProcID2</span><span class="o">/</span><span class="n">Schedule</span><span class="o">+</span><span class="n">Message</span><span class="o">=</span><span class="w"> </span><span class="err">\</span><span class="w">
    </span><span class="p" data-group-id="6376811722-1">(</span><span class="o">/</span><span class="n">ProcID1</span><span class="o">/</span><span class="n">Compute</span><span class="o">+</span><span class="n">Slot</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">Results</span><span class="o">/</span><span class="n">Outbox</span><span class="o">/</span><span class="mi">1</span><span class="p" data-group-id="6376811722-1">)</span></code></pre><p>This request is equivalent to:</p><pre><code class="makeup erlang" translate="no"><span class="ss">curl</span><span class="w"> </span><span class="nc">http</span><span class="p">:</span><span class="o">/</span><span class="o">/</span><span class="nc">host</span><span class="p">:</span><span class="ss">port</span><span class="o">/</span><span class="n">Hashpath</span><span class="o">/</span><span class="n">Compute</span><span class="o">/</span><span class="n">Results</span><span class="o">?</span><span class="n">WASM</span><span class="o">-</span><span class="n">Function</span><span class="o">=</span><span class="ss">fac</span><span class="err">&amp;</span><span class="n">WASM</span><span class="o">-</span><span class="n">Params</span><span class="o">=</span><span class="p" data-group-id="7693538683-1">[</span><span class="mi">11</span><span class="p" data-group-id="7693538683-1">]</span></code></pre><p>Load the WASM computation from an existing hashpath:</p><pre><code class="makeup erlang" translate="no"><span class="ss">curl</span><span class="w"> </span><span class="o">-</span><span class="n">X</span><span class="w"> </span><span class="n">POST</span><span class="w"> </span><span class="nc">http</span><span class="p">:</span><span class="o">/</span><span class="o">/</span><span class="nc">host</span><span class="p">:</span><span class="ss">port</span><span class="o">/</span><span class="n">Init</span><span class="o">/</span><span class="n">Compute</span><span class="w"> </span><span class="err">\</span><span class="w">
    </span><span class="o">-</span><span class="n">H</span><span class="w"> </span><span class="s">&quot;1.WASM-Image|Resolve: /OldHashpath/Snapshot/WASM&quot;</span><span class="w"> </span><span class="err">\</span><span class="w">
    </span><span class="o">-</span><span class="n">H</span><span class="w"> </span><span class="s">&quot;2.WASM-Function: fac&quot;</span><span class="w"> </span><span class="o">-</span><span class="n">H</span><span class="w"> </span><span class="s">&quot;2.WASM-Params: [10]&quot;</span></code></pre><p>To fork an existing process to use a new device, we can use the <code class="inline">~</code> key operator:</p><pre><code class="makeup erlang" translate="no"><span class="ss">curl</span><span class="w"> </span><span class="o">-</span><span class="n">X</span><span class="w"> </span><span class="n">POST</span><span class="w"> </span><span class="nc">http</span><span class="p">:</span><span class="o">/</span><span class="o">/</span><span class="nc">host</span><span class="p">:</span><span class="ss">port</span><span class="o">/</span><span class="n">Schedule</span><span class="err">~</span><span class="n">Process</span><span class="o">/</span><span class="mf">2.0</span><span class="o">/</span><span class="p" data-group-id="7610953950-1">(</span><span class="o">/</span><span class="n">ProcID</span><span class="o">/</span><span class="n">Now</span><span class="p" data-group-id="7610953950-1">)</span><span class="o">+</span><span class="n">Method</span><span class="o">=</span><span class="n">POST</span></code></pre><p>To run multiple computations in the same request, with separate headers for
each, we should be able to use <code class="inline">Header#N</code> modifiers:</p><pre><code class="makeup erlang" translate="no"><span class="ss">curl</span><span class="w"> </span><span class="o">-</span><span class="n">X</span><span class="w"> </span><span class="n">POST</span><span class="w"> </span><span class="nc">http</span><span class="p">:</span><span class="o">/</span><span class="o">/</span><span class="nc">host</span><span class="p">:</span><span class="ss">port</span><span class="o">/</span><span class="n">Init</span><span class="o">/</span><span class="n">Compute</span><span class="o">/</span><span class="n">Compute</span><span class="w"> </span><span class="o">-</span><span class="n">H</span><span class="w"> </span><span class="s">&quot;Device: WASM-64/1.0&quot;</span><span class="w"> </span><span class="err">\</span><span class="w">
    </span><span class="o">-</span><span class="n">H</span><span class="w"> </span><span class="s">&quot;2.WASM-Function: fac&quot;</span><span class="w"> </span><span class="o">-</span><span class="n">H</span><span class="w"> </span><span class="s">&quot;2.WASM-Params: [10]&quot;</span><span class="w"> </span><span class="err">\</span><span class="w">
    </span><span class="o">-</span><span class="n">H</span><span class="w"> </span><span class="s">&quot;3.WASM-Function: fac&quot;</span><span class="w"> </span><span class="o">-</span><span class="n">H</span><span class="w"> </span><span class="s">&quot;3.WASM-Params: [11]&quot;</span><span class="w"> </span><span class="err">\</span><span class="w">
</span><span class="w">    </span><span class="p">-</span><span class="na">d</span><span class="w"> </span><span class="p">@</span><span class="ss">test</span><span class="o">/</span><span class="ss">test</span><span class="o">-</span><span class="mi">64</span><span class="p">.</span><span class="ss">wasm</span></code></pre><p>This request is equivalent to:</p><pre><code class="makeup erlang" translate="no"><span class="ss">curl</span><span class="w"> </span><span class="nc">http</span><span class="p">:</span><span class="o">/</span><span class="o">/</span><span class="nc">host</span><span class="p">:</span><span class="ss">port</span><span class="o">/</span><span class="n">Init</span><span class="o">+</span><span class="n">Device</span><span class="o">=</span><span class="n">WASM</span><span class="o">-</span><span class="mi">64</span><span class="o">/</span><span class="mf">1.0</span><span class="o">+</span><span class="n">Image</span><span class="o">=</span><span class="n">ID</span><span class="o">/</span><span class="n">Compute</span><span class="o">+</span><span class="w"> </span><span class="err">\</span><span class="w">
    </span><span class="n">WASM</span><span class="o">-</span><span class="n">Function</span><span class="o">=</span><span class="ss">fac</span><span class="o">+</span><span class="n">WASM</span><span class="o">-</span><span class="n">Params</span><span class="o">=</span><span class="p" data-group-id="6071043269-1">[</span><span class="mi">10</span><span class="p" data-group-id="6071043269-1">]</span><span class="o">/</span><span class="n">Compute</span><span class="o">+</span><span class="n">WASM</span><span class="o">-</span><span class="n">Function</span><span class="o">=</span><span class="ss">fac</span><span class="err">&amp;</span><span class="n">WASM</span><span class="o">-</span><span class="n">Params</span><span class="o">=</span><span class="p" data-group-id="6071043269-2">[</span><span class="mi">11</span><span class="p" data-group-id="6071043269-2">]</span></code></pre><p>Gather the node's known commitments (including its own) on a process output:</p><pre><code class="makeup erlang" translate="no"><span class="ss">curl</span><span class="w"> </span><span class="nc">http</span><span class="p">:</span><span class="o">/</span><span class="o">/</span><span class="nc">host</span><span class="p">:</span><span class="ss">port</span><span class="o">/</span><span class="n">ProcID</span><span class="o">/</span><span class="n">Compute</span><span class="o">+</span><span class="n">Slot</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">Results</span><span class="o">/</span><span class="n">Commitments</span></code></pre><p>Dry-run a message on top of an AO process state:</p><pre><code class="makeup erlang" translate="no"><span class="ss">curl</span><span class="w"> </span><span class="o">-</span><span class="n">X</span><span class="w"> </span><span class="n">POST</span><span class="w"> </span><span class="nc">http</span><span class="p">:</span><span class="o">/</span><span class="o">/</span><span class="nc">host</span><span class="p">:</span><span class="ss">port</span><span class="o">/</span><span class="n">ProcID</span><span class="o">/</span><span class="n">Compute</span><span class="w"> </span><span class="err">\</span><span class="w">
    </span><span class="o">-</span><span class="n">H</span><span class="w"> </span><span class="s">&quot;Action: Balance&quot;</span><span class="w"> </span><span class="o">-</span><span class="n">H</span><span class="w"> </span><span class="s">&quot;Recipient: Address&quot;</span></code></pre>
</div>

<div class="bottom-actions" id="bottom-actions">
  <div class="bottom-actions-item">

      <a href="ao-core-protocol.html" class="bottom-actions-button" rel="prev">
        <span class="subheader">
          ← Previous Page
        </span>
        <span class="title">
The AO-Core protocol.
        </span>
      </a>

  </div>
  <div class="bottom-actions-item">

      <a href="hacking-on-hyperbeam.html" class="bottom-actions-button" rel="next">
        <span class="subheader">
          Next Page →
        </span>
        <span class="title">
Hacking on HyperBEAM
        </span>
      </a>

  </div>
</div>
    <footer class="footer">
      <p>

          <span class="line">
            <a href="https://hex.pm/packages/hb/0.0.1" class="footer-hex-package">Hex Package</a>

            <a href="https://preview.hex.pm/preview/hb/0.0.1">Hex Preview</a>

              (<a href="https://preview.hex.pm/preview/hb/0.0.1/show/docs/ao-http-api.md">current file</a>)

          </span>

        <span class="line">
          <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
            Search HexDocs
          </button>

            <a href="hb.epub" title="ePub version">
              Download ePub version
            </a>

        </span>
      </p>

      <p class="built-using">
        Built using
        <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.35.1) for the

          <a href="https://erlang.org" title="Erlang" target="_blank" translate="no">Erlang programming language</a>

      </p>

    </footer>
  </div>
</main>
</div>

  </body>
</html>
