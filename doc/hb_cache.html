<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.35.1">
    <meta name="project" content="hb v0.0.1">


    <title>hb_cache â€” hb v0.0.1</title>
    <link rel="stylesheet" href="dist/html-erlang-4IXSOGMD.css" />


    <script src="dist/handlebars.runtime-NWIB6V2M.js"></script>
    <script src="dist/handlebars.templates-K7URE6B4.js"></script>
    <script src="dist/sidebar_items-BF2C6ECE.js"></script>
    <script src="docs_config.js"></script>
    <script async src="dist/html-PVRIOB7F.js"></script>

  </head>
  <body data-type="modules" class="page-module">
    <script>

      try {
        var settings = JSON.parse(localStorage.getItem('ex_doc:settings') || '{}');

        if (settings.theme === 'dark' ||
           ((settings.theme === 'system' || settings.theme == null) &&
             window.matchMedia('(prefers-color-scheme: dark)').matches)
           ) {
          document.body.classList.add('dark')
        }
      } catch (error) { }
    </script>

<div class="body-wrapper">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

      <div>
        <a href="readme.html" class="sidebar-projectName" translate="no">
hb
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v0.0.1
        </div>
      </div>
    </div>
    <ul id="sidebar-listNav" class="sidebar-listNav" role="tablist">
      <li>
        <button id="extras-list-tab-button" role="tab" data-type="extras" aria-controls="extras-tab-panel" aria-selected="true" tabindex="0">
Pages
        </button>
      </li>

        <li>
          <button id="modules-list-tab-button" role="tab" data-type="modules" aria-controls="modules-tab-panel" aria-selected="false" tabindex="-1">
            Modules
          </button>
        </li>


    </ul>
  </div>

  <div id="extras-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="extras-list-tab-button">
    <ul id="extras-full-list" class="full-list"></ul>
  </div>

    <div id="modules-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="modules-list-tab-button" hidden>
      <ul id="modules-full-list" class="full-list"></ul>
    </div>


</nav>

<main class="content">
  <output role="status" id="toast"></output>

  <div id="content" class="content-inner">
    <div class="top-search">
      <div class="search-settings">
        <form class="search-bar" action="search.html">
          <label class="search-label">
            <span class="sr-only">Search documentation of hb</span>
            <input name="q" type="text" class="search-input" placeholder="Press / to search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </label>
          <button type="submit" class="search-button" aria-label="Submit Search">
            <i class="ri-search-2-line ri-lg" aria-hidden="true" title="Submit search"></i>
          </button>
          <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
            <i class="ri-close-line ri-lg" title="Cancel search"></i>
          </button>
        </form>
        <div class="autocomplete">
        </div>
        <button class="icon-settings display-settings">
          <i class="ri-settings-3-line"></i>
          <span class="sr-only">Settings</span>
        </button>
      </div>
    </div>

<div id="top-content">
  <h1>

      <a href="https://github.com/permaweb/HyperBEAM/blob/v0.0.1/src/hb_cache.erl#L1" title="View Source" class="icon-action" rel="help">
        <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        <span class="sr-only">View Source</span>
      </a>

    <span translate="no">hb_cache</span> 
    <small class="app-vsn" translate="no">(hb v0.0.1)</small>

  </h1>


    <section id="moduledoc">
<p>A cache of AO-Core protocol messages and compute results.</p><p>HyperBEAM stores all paths in key value stores, abstracted by the <code class="inline">hb_store</code>
module. Each store has its own storage backend, but each works with simple
key-value pairs. Each store can write binary keys at paths, and link between
paths.</p><p>There are three layers to HyperBEAMs internal data representation on-disk:</p><ol><li>The raw binary data, written to the store at the hash of the content.
Storing binary paths in this way effectively deduplicates the data.</li><li>The hashpath-graph of all content, stored as a set of links between
hashpaths, their keys, and the data that underlies them. This allows
all messages to share the same hashpath space, such that all requests
from users additively fill-in the hashpath space, minimizing duplicated
compute.</li><li>Messages, referrable by their IDs (committed or uncommitted). These are
stored as a set of links commitment IDs and the uncommitted message.</li></ol><p>Before writing a message to the store, we convert it to Type-Annotated
Binary Messages (TABMs), such that each of the keys in the message is
either a map or a direct binary.</p>
    </section>

</div>

  <section id="summary" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#summary">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Summary</span>
    </h1>
<div class="summary-functions summary">
  <h2>
    <a href="#functions">Functions</a>
  </h2>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#cache_suite_test_/0" data-no-tooltip translate="no">cache_suite_test_()</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#link/3" data-no-tooltip translate="no">link(Existing, New, Opts)</a>

      </div>

        <div class="summary-synopsis"><p>Make a link from one path to another in the store.
Note: Argument order is `link(Src, Dst, Opts)'.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#list/2" data-no-tooltip translate="no">list/2</a>

      </div>

        <div class="summary-synopsis"><p>List all items under a given path.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#list_numbered/2" data-no-tooltip translate="no">list_numbered(Path, Opts)</a>

      </div>

        <div class="summary-synopsis"><p>List all items in a directory, assuming they are numbered.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#read/2" data-no-tooltip translate="no">read(Path, Opts)</a>

      </div>

        <div class="summary-synopsis"><p>Read the message at a path. Returns in <code class="inline">structured@1.0</code> format: Either a
richly typed map or a direct binary.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#read_resolved/3" data-no-tooltip translate="no">read_resolved/3</a>

      </div>

        <div class="summary-synopsis"><p>Read the output of a prior computation, given Msg1, Msg2, and some
options.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#run_test/0" data-no-tooltip translate="no">run_test()</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#test_device_map_cannot_be_written_test/0" data-no-tooltip translate="no">test_device_map_cannot_be_written_test()</a>

      </div>

        <div class="summary-synopsis"><p>Test that message whose device is <code class="inline">#{}</code> cannot be written. If it were to
be written, it would cause an infinite loop.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#test_signed/1" data-no-tooltip translate="no">test_signed(Data)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#test_unsigned/1" data-no-tooltip translate="no">test_unsigned(Data)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#write/2" data-no-tooltip translate="no">write/2</a>

      </div>

        <div class="summary-synopsis"><p>Write a message to the cache. For raw binaries, we write the data at
the hashpath of the data (by default the SHA2-256 hash of the data). We link
the unattended ID's hashpath for the keys (including <code class="inline">/commitments</code>) on the
message to the underlying data and recurse. We then link each commitment ID
to the uncommitted message, such that any of the committed or uncommitted IDs
can be read, and once in memory all of the commitments are available. For
deep messages, the commitments will also be read, such that the ID of the
outer message (which does not include its commitments) will be built upon
the commitments of the inner messages. We do not, however, store the IDs from
commitments on signed <em>inner</em> messages. We may wish to revisit this.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#write_binary/3" data-no-tooltip translate="no">write_binary(Hashpath, Bin, Opts)</a>

      </div>

        <div class="summary-synopsis"><p>Write a raw binary keys into the store and link it at a given hashpath.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#write_hashpath/2" data-no-tooltip translate="no">write_hashpath/2</a>

      </div>

        <div class="summary-synopsis"><p>Write a hashpath and its message to the store and link it.</p></div>

    </div>

</div>

  </section>


  <section id="functions" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#functions">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Functions</span>
    </h1>
    <div class="functions-list">
<section class="detail" id="cache_suite_test_/0">

  <div class="detail-header">
    <a href="#cache_suite_test_/0" class="detail-link" data-no-tooltip aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <h1 class="signature" translate="no">cache_suite_test_()</h1>

      <a href="https://github.com/permaweb/HyperBEAM/blob/v0.0.1/src/hb_cache.erl#L478" class="icon-action" rel="help" aria-label="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
     </a>


  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="link/3">

  <div class="detail-header">
    <a href="#link/3" class="detail-link" data-no-tooltip aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <h1 class="signature" translate="no">link(Existing, New, Opts)</h1>

      <a href="https://github.com/permaweb/HyperBEAM/blob/v0.0.1/src/hb_cache.erl#L318" class="icon-action" rel="help" aria-label="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
     </a>


  </div>

  <section class="docstring">

<p>Make a link from one path to another in the store.
Note: Argument order is `link(Src, Dst, Opts)'.</p>
  </section>
</section>
<section class="detail" id="list/2">

  <div class="detail-header">
    <a href="#list/2" class="detail-link" data-no-tooltip aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <h1 class="signature" translate="no">list/2</h1>

      <a href="https://github.com/permaweb/HyperBEAM/blob/v0.0.1/src/hb_cache.erl#L42" class="icon-action" rel="help" aria-label="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
     </a>


  </div>

  <section class="docstring">

<p>List all items under a given path.</p>
  </section>
</section>
<section class="detail" id="list_numbered/2">

  <div class="detail-header">
    <a href="#list_numbered/2" class="detail-link" data-no-tooltip aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <h1 class="signature" translate="no">list_numbered(Path, Opts)</h1>

      <a href="https://github.com/permaweb/HyperBEAM/blob/v0.0.1/src/hb_cache.erl#L35" class="icon-action" rel="help" aria-label="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
     </a>


  </div>

  <section class="docstring">

<p>List all items in a directory, assuming they are numbered.</p>
  </section>
</section>
<section class="detail" id="read/2">

  <div class="detail-header">
    <a href="#read/2" class="detail-link" data-no-tooltip aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <h1 class="signature" translate="no">read(Path, Opts)</h1>

      <a href="https://github.com/permaweb/HyperBEAM/blob/v0.0.1/src/hb_cache.erl#L202" class="icon-action" rel="help" aria-label="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
     </a>


  </div>

  <section class="docstring">

<p>Read the message at a path. Returns in <code class="inline">structured@1.0</code> format: Either a
richly typed map or a direct binary.</p>
  </section>
</section>
<section class="detail" id="read_resolved/3">

  <div class="detail-header">
    <a href="#read_resolved/3" class="detail-link" data-no-tooltip aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <h1 class="signature" translate="no">read_resolved/3</h1>

      <a href="https://github.com/permaweb/HyperBEAM/blob/v0.0.1/src/hb_cache.erl#L304" class="icon-action" rel="help" aria-label="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
     </a>


  </div>

  <section class="docstring">

<p>Read the output of a prior computation, given Msg1, Msg2, and some
options.</p>
  </section>
</section>
<section class="detail" id="run_test/0">

  <div class="detail-header">
    <a href="#run_test/0" class="detail-link" data-no-tooltip aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <h1 class="signature" translate="no">run_test()</h1>

      <a href="https://github.com/permaweb/HyperBEAM/blob/v0.0.1/src/hb_cache.erl#L504" class="icon-action" rel="help" aria-label="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
     </a>


  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="test_device_map_cannot_be_written_test/0">

  <div class="detail-header">
    <a href="#test_device_map_cannot_be_written_test/0" class="detail-link" data-no-tooltip aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <h1 class="signature" translate="no">test_device_map_cannot_be_written_test()</h1>

      <a href="https://github.com/permaweb/HyperBEAM/blob/v0.0.1/src/hb_cache.erl#L492" class="icon-action" rel="help" aria-label="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
     </a>


  </div>

  <section class="docstring">

<p>Test that message whose device is <code class="inline">#{}</code> cannot be written. If it were to
be written, it would cause an infinite loop.</p>
  </section>
</section>
<section class="detail" id="test_signed/1">

  <div class="detail-header">
    <a href="#test_signed/1" class="detail-link" data-no-tooltip aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <h1 class="signature" translate="no">test_signed(Data)</h1>

      <a href="https://github.com/permaweb/HyperBEAM/blob/v0.0.1/src/hb_cache.erl#L339" class="icon-action" rel="help" aria-label="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
     </a>


  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="test_unsigned/1">

  <div class="detail-header">
    <a href="#test_unsigned/1" class="detail-link" data-no-tooltip aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <h1 class="signature" translate="no">test_unsigned(Data)</h1>

      <a href="https://github.com/permaweb/HyperBEAM/blob/v0.0.1/src/hb_cache.erl#L332" class="icon-action" rel="help" aria-label="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
     </a>


  </div>

  <section class="docstring">


  </section>
</section>
<section class="detail" id="write/2">

  <div class="detail-header">
    <a href="#write/2" class="detail-link" data-no-tooltip aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <h1 class="signature" translate="no">write/2</h1>

      <a href="https://github.com/permaweb/HyperBEAM/blob/v0.0.1/src/hb_cache.erl#L68" class="icon-action" rel="help" aria-label="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
     </a>


  </div>

  <section class="docstring">

<p>Write a message to the cache. For raw binaries, we write the data at
the hashpath of the data (by default the SHA2-256 hash of the data). We link
the unattended ID's hashpath for the keys (including <code class="inline">/commitments</code>) on the
message to the underlying data and recurse. We then link each commitment ID
to the uncommitted message, such that any of the committed or uncommitted IDs
can be read, and once in memory all of the commitments are available. For
deep messages, the commitments will also be read, such that the ID of the
outer message (which does not include its commitments) will be built upon
the commitments of the inner messages. We do not, however, store the IDs from
commitments on signed <em>inner</em> messages. We may wish to revisit this.</p>
  </section>
</section>
<section class="detail" id="write_binary/3">

  <div class="detail-header">
    <a href="#write_binary/3" class="detail-link" data-no-tooltip aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <h1 class="signature" translate="no">write_binary(Hashpath, Bin, Opts)</h1>

      <a href="https://github.com/permaweb/HyperBEAM/blob/v0.0.1/src/hb_cache.erl#L191" class="icon-action" rel="help" aria-label="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
     </a>


  </div>

  <section class="docstring">

<p>Write a raw binary keys into the store and link it at a given hashpath.</p>
  </section>
</section>
<section class="detail" id="write_hashpath/2">

  <div class="detail-header">
    <a href="#write_hashpath/2" class="detail-link" data-no-tooltip aria-label="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
    </a>
    <h1 class="signature" translate="no">write_hashpath/2</h1>

      <a href="https://github.com/permaweb/HyperBEAM/blob/v0.0.1/src/hb_cache.erl#L177" class="icon-action" rel="help" aria-label="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
     </a>


  </div>

  <section class="docstring">

<p>Write a hashpath and its message to the store and link it.</p>
  </section>
</section>

    </div>
  </section>

    <footer class="footer">
      <p>

          <span class="line">
            <a href="https://hex.pm/packages/hb/0.0.1" class="footer-hex-package">Hex Package</a>

            <a href="https://preview.hex.pm/preview/hb/0.0.1">Hex Preview</a>

          </span>

        <span class="line">
          <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
            Search HexDocs
          </button>

            <a href="hb.epub" title="ePub version">
              Download ePub version
            </a>

        </span>
      </p>

      <p class="built-using">
        Built using
        <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.35.1) for the

          <a href="https://erlang.org" title="Erlang" target="_blank" translate="no">Erlang programming language</a>

      </p>

    </footer>
  </div>
</main>
</div>

  </body>
</html>
